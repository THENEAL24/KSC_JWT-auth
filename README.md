# User Service (JWT Auth)

–ú–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω—ã–π Go-—Å–µ—Ä–≤–∏—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å JWT-–∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π.

## üì¶ –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏
- POST `/register` ‚Äì —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç JWT
- POST `/login` ‚Äì –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç JWT
- GET `/me` ‚Äì –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ (—Ç—Ä–µ–±—É–µ—Ç—Å—è JWT)
- POST `/users/{id}/roles` ‚Äì –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ —Ä–æ–ª–∏ (—Ç—Ä–µ–±—É–µ—Ç—Å—è —Ä–æ–ª—å `admin`)

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –í–∞—Ä–∏–∞–Ω—Ç 1: –õ–æ–∫–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ (Docker Compose)
```bash
make start
```
–°–µ—Ä–≤–∏—Å –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ `http://localhost:8080`

### –í–∞—Ä–∏–∞–Ω—Ç 2: –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –≤ Kubernetes (kind)
```bash
make deploy-kind
make connect
```
–°–µ—Ä–≤–∏—Å –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ `http://localhost:8080`

## ‚öôÔ∏è –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

### –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞
```bash
make build    # –°–±–æ—Ä–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
make run      # –ó–∞–ø—É—Å–∫ –ª–æ–∫–∞–ª—å–Ω–æ
make tidy     # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
make clean    # –û—á–∏—Å—Ç–∫–∞ —Å–±–æ—Ä–∫–∏
```

### –ú–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
```bash
make migrate-up    # –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
make migrate-down  # –û—Ç–∫–∞—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
```

### Docker –∏ Kubernetes
```bash
make docker-build  # –°–±–æ—Ä–∫–∞ Docker-–æ–±—Ä–∞–∑–∞
make deploy-kind   # –ü–æ–ª–Ω–æ–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –≤ kind
make connect       # –ü—Ä–æ–±—Ä–æ—Å –ø–æ—Ä—Ç–æ–≤ –¥–ª—è –¥–æ—Å—Ç—É–ø–∞
make k8s-logs      # –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
make k8s-status    # –°—Ç–∞—Ç—É—Å –ø–æ–¥–æ–≤ –∏ —Å–µ—Ä–≤–∏—Å–æ–≤
make k8s-delete    # –£–¥–∞–ª–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤ –∏–∑ k8s
```

## üîß –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è
- Go 1.21+
- Docker –∏ Docker Compose
- kind (–¥–ª—è Kubernetes –≤–∞—Ä–∏–∞–Ω—Ç–∞)
- PostgreSQL

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
```
‚îú‚îÄ‚îÄ cmd/user-service/     # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îú‚îÄ‚îÄ internal/             # –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –ø–∞–∫–µ—Ç—ã
‚îú‚îÄ‚îÄ migrations/           # –ú–∏–≥—Ä–∞—Ü–∏–∏ –ë–î
‚îú‚îÄ‚îÄ deploy/               # Kubernetes –º–∞–Ω–∏—Ñ–µ—Å—Ç—ã
‚îî‚îÄ‚îÄ Makefile             # –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è
```

## üîê –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env`:
```env
JWT_SECRET=your_secret_key
DATABASE_URL=postgres://postgres:postgres@localhost:5432/usersdb?sslmode=disable
```

## üì° –ü—Ä–∏–º–µ—Ä—ã API –∑–∞–ø—Ä–æ—Å–æ–≤

### –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
```bash
curl -X POST http://localhost:8080/register \
  -H "Content-Type: application/json" \
  -d '{"email":"test@example.com","password":"password123"}'
```

### –í—Ö–æ–¥
```bash
curl -X POST http://localhost:8080/login \
  -H "Content-Type: application/json" \
  -d '{"email":"test@example.com","password":"password123"}'
```

### –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Å–µ–±–µ
```bash
curl http://localhost:8080/me \
  -H "Authorization: Bearer YOUR_JWT_TOKEN"
```

## üóëÔ∏è –û—á–∏—Å—Ç–∫–∞
```bash
# –£–¥–∞–ª–∏—Ç—å kind –∫–ª–∞—Å—Ç–µ—Ä
make kind-delete

# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Docker Compose
docker-compose down
```

## üåê OAuth –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
–°–µ—Ä–≤–∏—Å –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç OAuth 2.0 —á–µ—Ä–µ–∑ —Å—Ç–æ—Ä–æ–Ω–Ω–∏—Ö –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ (Google, Yandex –∏ –¥—Ä.).

### –û—Å–Ω–æ–≤–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã
- `GET /auth/{provider}` ‚Äî –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, Google, Yandex)
- `GET /auth/{provider}/callback` ‚Äî –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–≤–µ—Ç–∞ –æ—Ç –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞, —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –≤—ã–¥–∞—á–∞ JWT

### –ü—Ä–∏–º–µ—Ä –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ Google
1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –ø–æ —Å—Å—ã–ª–∫–µ:
   ```
   http://localhost:8080/auth/google
   ```
2. –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–∏–∑–æ–π–¥—ë—Ç —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ `/auth/google/callback`, –≥–¥–µ —Å–µ—Ä–≤–∏—Å –æ–±—Ä–∞–±–æ—Ç–∞–µ—Ç –æ—Ç–≤–µ—Ç –∏ –≤—ã–¥–∞—Å—Ç JWT-—Ç–æ–∫–µ–Ω –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ API.

### –ü—Ä–∏–º–µ—á–∞–Ω–∏—è
- –î–ª—è —Ä–∞–±–æ—Ç—ã OAuth –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è —Å –∫–ª—é—á–∞–º–∏ –∏ —Å–µ–∫—Ä–µ—Ç–∞–º–∏ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ (—Å–º. `.env.example`)
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è —Ä–∞—Å—à–∏—Ä—è–µ–º—ã–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã —á–µ—Ä–µ–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è
- –ü–∞—Ä–æ–ª–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ —Ö—ç—à–∏—Ä–æ–≤–∞–Ω–Ω–æ–º –≤–∏–¥–µ (bcrypt)
- JWT —Ç–æ–∫–µ–Ω—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç –∞–ª–≥–æ—Ä–∏—Ç–º HS256
- –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –Ω–∞—á–∞–ª—å–Ω—ã–º–∏ —Ä–æ–ª—è–º–∏ (user, admin)
- –õ–æ–≥–∏ –≤—ã–≤–æ–¥—è—Ç—Å—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON —á–µ—Ä–µ–∑ zap
